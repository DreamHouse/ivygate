YUI.add("zmm-api",function(a){YUI().use("jsonp",function(i){var k=10000,h="deadbeef-dead-beef-dead-beefdeadbeef",f=a.namespace("ZMM.API"),b;
try{b=a.one(".zmm-api-config").get("hiddenBlockJSON");}catch(g){throw"the page does not include configuration for the zmm-api component; add the ZMMAPI component to your HTML!";
}if(b.userSessionId===null){b.userSessionId=h;}f.partnerId=b.partnerId;f.userSessionId=b.userSessionId;
f.stateAbbreviation=b.stateAbbreviation;if(b.user){f.user=b.user;}if(b.bot){f.bot=b.bot;}function d(n,l){var e=[];
function m(p,o){if(a.Lang.isNumber(p)||a.Lang.isString(p)||a.Lang.isBoolean(p)){e.push(encodeURIComponent(o)+"="+encodeURIComponent(p));
}else{if((a.Lang.isObject(p)&&!a.Object.isEmpty(p))||(a.Lang.isArray(p)&&p.length)){a.each(p,function(r,q){m(r,o+"."+q);
});}else{if(!a.Lang.isUndefined(p)){e.push(encodeURIComponent(o)+"=");}}}}a.each(n,function(p,o){m(p,o);
});if(l){e.push("jsonp={callback}");}return e.length?"?"+e.join("&"):"";}function c(m,q){var n=q.context,p=q.success,l=q.failure,o=q.timeout||k;
function e(r){if(r&&!r.error){if(a.Lang.isFunction(p)){p.call(n,r);}}else{if(a.Lang.isFunction(l)){l.call(n,r);
}}}if(q.method==="POST"){a.io(m,{method:"POST",data:a.JSON.stringify(q.input||{}),headers:{"Content-Type":"application/json"},on:{complete:function(u,s){var r=null;
if(s.status===200||s.status===500){try{r=a.JSON.parse(s.responseText);}catch(t){}}e(r);}}});}else{i.jsonp(m,{timeout:o,on:{success:function(r){e(r);
},failure:function(){e(null);},timeout:function(){e(null);}}});}}function j(o){var m=b.serverURLs[o];
function e(p){return m+"/"+p;}function l(q,p){return e(q.action)+d(q.input||{},p);}function n(p){c((p.method==="POST")?e(p.action):l(p,true),p);
}n.baseURL=m;n.url=l;return n;}f.MAX=j("MAX");f.MIN=j("MIN");f.MCA=j("MCA");f.log=function(e){f.MAX({action:"log",input:{message:""+e}});
};f.abTreatment=function(n,o){var l;try{l=b.abs[n];}catch(m){}return l||o;};f.apiServerQueryParams=d;
});},"3.7.0",{requires:["node","json","jsonp","zillow-hidden-block"]});
YUI.add("zmm-datetime",function(c){function b(e){var d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],g=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.\d+)?(?:Z|([\-+])(\d{2}):(\d{2}))?$/.exec(e),f;
if(!g){return null;}f=g[3]+" "+d[g[2]-1]+" "+g[1]+" "+g[4]+":"+g[5]+":"+g[6]+" GMT"+(g[7]?(g[7]+g[8]+g[9]):"-0000");
return new Date(f);}function a(k){if(!k){return undefined;}var i=k.getMonth()+1,f=k.getDate(),h=k.getFullYear(),e=k.getHours()%12,j=k.getMinutes(),g=k.getHours()>=12?"PM":"AM";
return""+i+"/"+f+"/"+h+" at "+(e||"12")+":"+(j<10?"0":"")+j+" "+g;}c.namespace("ZMM").Datetime={iso8601ToLocalDate:b,friendlyFormat:a};
},"3.7.0",{requires:[]});
YUI.add("zmm-rate-chart",function(d){var e="dateRange",a="percentage",c="quoteVolume";function b(){b.superclass.constructor.apply(this,arguments);
}b.SERIES_TYPE={BOTH:"both",NATIONAL:"national",LOCAL:"local",NONE:"none"};b.TIMESPAN={DAY:"day",WEEK:"week",MONTH:"month",THREE_MONTHS:"three monnths",YEAR:"year",TWO_YEARS:"two years"};
d.extend(b,d.Base,{initializer:function(){this.after("dataProviderChange",this._render);},_render:function(){var f=d.one(this.get("selector")),g=this,h;
if(this.get("_yuiChart")){this.clear();}if(f){this.set("_yuiChart",new d.Chart(this._getConfig()));if(this._getRateTooltip()){f.one(".yui3-overlay").on("mouseout",function(){g._hideRateTooltip();
});}h=f.one(".yui3-graph");if(h){h.setStyle("overflow","visible");}}},clear:function(){var f=d.one(this.get("selector"));
if(f){f.get("childNodes").remove();}},_getConfig:function(){var k=this.get("yuiChartConfig"),h=this.get("dataProvider"),i={dataProvider:h,seriesKeys:this._getRateKeys().concat(this._getVolumeKeys()),seriesCollection:this._getSeriesCollection(),styles:this._getStyles(),axes:this._getAxes(),horizontalGridlines:true,verticalGridlines:false,showMarkers:false,categoryKey:this.get("keyDate"),categoryType:"time",render:this.get("selector"),interactionType:"planar",tooltip:this._getRateTooltip()},f=this.get("rateType"),j=this.get("volumeType"),g=d.mix(i,k,true,null,0,true);
if(f===b.SERIES_TYPE.NONE||f===b.SERIES_TYPE.NATIONAL){delete g.styles.series[this.get("keyLocalRate")];
}if(f===b.SERIES_TYPE.NONE||f===b.SERIES_TYPE.LOCAL){delete g.styles.series[this.get("keyNationalRate")];
}if(f===b.SERIES_TYPE.NONE){delete g.axes[a];}if(j===b.SERIES_TYPE.NONE||j===b.SERIES_TYPE.NATIONAL){delete g.styles.series[this.get("keyLocalVolume")];
}if(j===b.SERIES_TYPE.NONE||j===b.SERIES_TYPE.LOCAL){delete g.styles.series[this.get("keyNationalVolume")];
}if(j===b.SERIES_TYPE.NONE){delete g.axes[c];}if(!h||!h.length){d.each(g.axes,function(l){l.labelFunction=function(){return"";
};});}return g;},_getRateKeys:function(){var g=[],f=this.get("rateType");if(f===b.SERIES_TYPE.BOTH||f===b.SERIES_TYPE.LOCAL){g.push(this.get("keyLocalRate"));
}if(f===b.SERIES_TYPE.BOTH||f===b.SERIES_TYPE.NATIONAL){g.push(this.get("keyNationalRate"));}return g;
},_getVolumeKeys:function(){var f=[],g=this.get("volumeType");if(g===b.SERIES_TYPE.BOTH||g===b.SERIES_TYPE.LOCAL){f.push(this.get("keyLocalVolume"));
}if(g===b.SERIES_TYPE.BOTH||g===b.SERIES_TYPE.NATIONAL){f.push(this.get("keyNationalVolume"));}return f;
},_getSeriesCollection:function(){return[{type:"column",xAxis:e,yAxis:c,xKey:this.get("keyDate"),yKey:this.get("keyLocalVolume"),xDisplayName:"Date",yDisplayName:"Local Volume"},{type:"column",xAxis:e,yAxis:c,xKey:this.get("keyDate"),yKey:this.get("keyNationalVolume"),xDisplayName:"Date",yDisplayName:"National Volume"},{type:"combo",xAxis:e,yAxis:a,xKey:this.get("keyDate"),yKey:this.get("keyLocalRate"),xDisplayName:"Date",yDisplayName:"Local Rate"},{type:"combo",xAxis:e,yAxis:a,xKey:this.get("keyDate"),yKey:this.get("keyNationalRate"),xDisplayName:"Date",yDisplayName:"National Rate"}];
},_getStyles:function(){var g=this._getYMajorUnitCount(),f={graph:{background:{fill:{color:"#FFFFFF"},border:{color:"#CCCCCC",weight:1}}}};
f.axes={};f.axes[e]={majorTicks:{weight:0},majorUnit:{determinant:"count",count:this._getXMajorUnitCount()},label:{margin:{top:5},color:"#000000"}};
f.axes[a]={majorTicks:{weight:0},label:{color:"#000000"},majorUnit:{determinant:"count",count:g}};f.axes[c]={majorTicks:{weight:0},majorUnit:{determinant:"count",count:g},label:{color:"#000000",display:"block"}};
f.series={};f.series[this.get("keyLocalRate")]={line:{color:"#5577BB",weight:2},marker:{shape:"rect",width:this._getMarkerWidth(),height:10}};
f.series[this.get("keyNationalRate")]={line:{color:"#88BB44",weight:2},marker:{shape:"rect",width:this._getMarkerWidth(),height:10}};
f.series[this.get("keyLocalVolume")]={fill:{color:"#CDD7EB"},border:{weight:1,color:"#E6EBF5"},over:{fill:{alpha:0.7}}};
f.series[this.get("keyNationalVolume")]={fill:{color:"#CFE4B4"},border:{weight:1,color:"#E6EBF5"},over:{fill:{alpha:0.7}}};
return f;},_getMarkerWidth:function(){switch(this.get("timespan")){case b.TIMESPAN.DAY:return 18;case b.TIMESPAN.WEEK:case b.TIMESPAN.MONTH:return 15;
case b.TIMESPAN.THREE_MONTHS:return 11;default:return 9;}},_getAxes:function(){var f={};f[e]={keys:[this.get("keyDate")],position:"bottom",type:"time",labelFormat:this._getLabelFormat()};
f[a]={type:"numeric",position:"right",keys:this._getRateKeys(),labelFormat:{suffix:"%",decimalPlaces:2},minimum:this._removeAxisPadding(this._getAxisMinimum()),maximum:this._addAxisPadding(this._getAxisMaximum())};
f[c]={type:"numeric",position:"left",keys:this._getVolumeKeys(),labelFormat:{thousandsSeparator:","}};
return f;},_addAxisPadding:function(g){var f=0.05,h=f*0.75;return Math.ceil((g+h)/f)*f;},_removeAxisPadding:function(g){var f=0.05,h=f*0.75;
return Math.floor((g-h)/f)*f;},_getAxisMaximum:function(f){return this._getAxisMinimum(!f);},_getAxisMinimum:function(l){var k=this.get("dataProvider"),j=this.get("keyNationalRate"),g=this.get("keyLocalRate"),f=this.get("rateType"),i=l?0:10,h=i;
if(k){h=d.Array.reduce(k,i,function(p,q){var o=q[j],n=q[g],m=[p];if((f===b.SERIES_TYPE.BOTH||f===b.SERIES_TYPE.NATIONAL)&&typeof o==="number"){m.push(o);
}if((f===b.SERIES_TYPE.BOTH||f===b.SERIES_TYPE.LOCAL)&&typeof n==="number"){m.push(n);}if(l){return Math.max.apply(Math,m);
}else{return Math.min.apply(Math,m);}});}if(h===i){return l?10:0;}else{return h;}},_getLabelFormat:function(){switch(this.get("timespan")){case b.TIMESPAN.DAY:return"%l %p";
case b.TIMESPAN.WEEK:return"%a";case b.TIMESPAN.MONTH:return"%m/%d";case b.TIMESPAN.THREE_MONTHS:return"%b %d";
case b.TIMESPAN.YEAR:return"%b";case b.TIMESPAN.TWO_YEARS:if(this.get("verboseLabels")){return"%b %Y";
}return"%Y";default:return"%Y";}},_getRateTooltip:function(){var g=this._getTooltipLabelFormat();var f=this._getDateLabel();
if(!this.get("yuiChartConfig")||!this.get("yuiChartConfig").tooltip){return{show:true,styles:{backgroundColor:"#fff",color:"#555",borderColor:"#dedede",textAlign:"left"},planarLabelFunction:function(o,l,j,n,h){var m=d.one(document.createElement("div")),k;
m.setHTML("<span style='font-weight:bold'>"+f+": </span><span>"+o.get("labelFunction").apply(this,[o.get("data")[j],g])+"</span>");
for(k=l.length-1;k>=0;k--){if(l[k].key==="nationalPercentageRate"){m.append("<br><span style='color:#88BB44; font-weight:bold' >"+l[k].displayName+": </span>"+l[k].value+"%");
}if(l[k].key==="localPercentageRate"){m.append("<br><span style='color:#5577BB; font-weight:bold'>"+l[k].displayName+": </span>"+l[k].value+"%");
}}return m;},planarEventHandler:function(r){var s=this.get("tooltip"),k,l=s.node,q=this.get("categoryAxis"),n=this.get("contentBox"),z=10,u=r.x+z,t=r.y+z,p,A,j=this.get("graph").get("gridlines").get("graphic"),v=j.get("width"),o=j.get("height"),B=this.get("tooltipLine"),i=j.get("autoDraw"),m=parseInt(l.siblings(".yui3-timeaxis").getStyle("left"),10);
k=s.planarLabelFunction.apply(this,[q,r.valueItem,r.index,r.items,r.seriesIndex]);this._showTooltip(k,u,t);
if(l){l.setContent(k);l.show();p=parseFloat(l.getComputedStyle("width"));A=parseFloat(l.getComputedStyle("height"));
if(u+p>parseFloat(n.getComputedStyle("width"))&&u-p>0){u=r.x-z-p;}l.setStyle("left",u+"px");l.setStyle("top",t+"px");
}j.set("autoDraw",true);if(!B){B=j.addShape({type:"path",stroke:{color:"#555",weight:2}});this.set("tooltipLine",B);
}B.clear();B.moveTo(r.x-m,0);B.lineTo(r.x-m,o);B.end();j.set("autoDraw",i);}};}return null;},_getTooltipLabelFormat:function(){switch(this.get("timespan")){case b.TIMESPAN.DAY:return"%l %p";
case b.TIMESPAN.WEEK:return"%a";case b.TIMESPAN.MONTH:return"%m/%d";case b.TIMESPAN.THREE_MONTHS:case b.TIMESPAN.YEAR:return"%b %d";
default:return"%b %Y";}},_getDateLabel:function(){switch(this.get("timespan")){case b.TIMESPAN.DAY:return"Time";
case b.TIMESPAN.WEEK:return"Day";default:return"Date";}},_getYMajorUnitCount:function(){var f=d.one(this.get("selector"));
if(f&&f.get("offsetHeight")<140){return 3;}return 5;},_getXMajorUnitCount:function(){var h,g=d.one(this.get("selector")),f;
if(g){f=g.get("offsetWidth");}if(f&&f<155){return 3;}switch(this.get("timespan")){case b.TIMESPAN.DAY:h=12;
break;case b.TIMESPAN.WEEK:h=7;break;case b.TIMESPAN.MONTH:case b.TIMESPAN.THREE_MONTHS:case b.TIMESPAN.YEAR:h=5;
break;case b.TIMESPAN.TWO_YEARS:h=3;break;default:h=3;break;}if(f&&f<340){return Math.min(h,7);}return h;
},_hideRateTooltip:function(){var g=this.get("_yuiChart"),i=g.get("graph").get("gridlines").get("graphic"),h=i.get("autoDraw"),f=g.get("tooltipLine");
g.get("tooltip").node.hide();if(f){i.set("autoDraw",true);f.clear();f.moveTo(0,0);f.lineTo(0,0);f.end();
i.set("autoDraw",h);}}},{ATTRS:{selector:{value:null},dataProvider:{value:null},timespan:{value:b.TIMESPAN.TWO_YEARS},rateType:{value:b.SERIES_TYPE.BOTH},volumeType:{value:b.SERIES_TYPE.LOCAL},verboseLabels:{value:false},yuiChartConfig:{value:null},_yuiChart:{value:null},keyLocalRate:{value:"localPercentageRate"},keyNationalRate:{value:"nationalPercentageRate"},keyLocalVolume:{value:"localQuoteVolume"},keyNationalVolume:{value:"nationalQuoteVolume"},keyDate:{value:"date"}}});
d.namespace("ZMM").RateChart=b;},"3.7.3",{requries:["base","node","charts","array-extras"]});
YUI.add("zmm-util",function(a){a.namespace("ZMM").Util={arrayShuffle:function(b){var d=b.length,c,f,e;
if(d===0){return;}while(--d){c=Math.floor(Math.random()*(d+1));f=b[d];e=b[c];b[d]=e;b[c]=f;}},debounce:function(d,b,c){var e;
return function(){var f=arguments;if(e){clearTimeout(e);}e=setTimeout(function(){d.apply(c,f);e=null;
},b);};}};},"3.11.0",{requires:[]});
YUI.add("zmm-rate-viewer",function(a){var f=a.namespace("ZMM"),d={rid:"regionId",loty:"loanTypeId",ch:"creditId",lotv:"downPaymentId",ts:"timeframeId"},e={1:a.ZMM.RateChart.TIMESPAN.DAY,2:a.ZMM.RateChart.TIMESPAN.WEEK,3:a.ZMM.RateChart.TIMESPAN.MONTH,4:a.ZMM.RateChart.TIMESPAN.THREE_MONTHS,5:a.ZMM.RateChart.TIMESPAN.YEAR,6:a.ZMM.RateChart.TIMESPAN.TWO_YEARS},h={1:1,2:7,3:30,4:30*3,5:365,6:365*2},g={3:"AK",4:"AL",6:"AR",8:"AZ",9:"CA",10:"CO",11:"CT",13:"DE",14:"FL",16:"GA",18:"HI",19:"IA",20:"ID",21:"IL",22:"IN",23:"KS",24:"KY",25:"LA",26:"MA",27:"MD",28:"ME",30:"MI",31:"MN",32:"MO",34:"MS",35:"MT",36:"NC",37:"ND",38:"NE",39:"NH",40:"NJ",41:"NM",42:"NV",43:"NY",44:"OH",45:"OK",46:"OR",47:"PA",50:"RI",51:"SC",52:"SD",53:"TN",54:"TX",55:"UT",56:"VA",57:"VI",58:"VT",59:"WA",12:"DC",60:"WI",61:"WV",62:"WY",17:"GU",33:"MP",48:"PR"},c={1:"Fixed30Year",2:"Fixed15Year",3:"ARM5",4:"Fixed20Year",5:"ARM7"},j={1:"Normal",3:"High",4:"VeryHigh"},i={5:"Low",4:"High",3:"VeryHigh"};
function b(){b.superclass.constructor.apply(this,arguments);}f.RateViewer=a.extend(b,a.Base,{initializer:function(l){var k=(l&&l.rateChartConfig)||{},m=new a.ZMM.RateChart(k);
this.set("_rateChart",m);a.all(this.get("regionSelector")+" option[value=57]").remove();},updateNewsPost:function(){a.ZMM.API.MAX({action:"getRatesArticle",input:{partnerId:a.ZMM.API.partnerId,stateAbbreviation:g[this.get("regionId")],refinance:/^\/refinance/.test(window.location.pathname),program:c[this.get("loanTypeId")]},success:function(k){this.set("news",k);
},context:this});},_processSelectChange:function(n){var l=n.target,o=l.get("id"),k=d[o],m=+l.get("value");
if("#"+o===this.get("timeframeSelector")){this.get("_rateChart").set("timespan",e[m]);}this.set(k,m);
},hookEvents:function(){var o=this,m=[this.get("regionSelector"),this.get("loanTypeSelector"),this.get("creditSelector"),this.get("downPaymentSelector"),this.get("timeframeSelector")],p=m.join(","),l=a.all(p),n=a.one(this.get("quoteVolumeSelector")),k=200;
l.on("change",this._processSelectChange,this);if(n){n.on("click",function(r){var q=r.target.get("checked");
o.set("showQuoteVolume",q);});}this.after(["regionIdChange","loanTypeIdChange","creditIdChange","downPaymentIdChange","timeframeIdChange","showQuoteVolumeChange"],a.ZMM.Util.debounce(this.updateChart,k,this));
this.after(["regionIdChange","loanTypeIdChange"],a.ZMM.Util.debounce(this.updateNewsPost,k,this));},updateChart:function(){var l={national:{program:c[this.get("loanTypeId")],loanToValueBucket:j[this.get("downPaymentId")],creditScoreBucket:i[this.get("creditId")]}},k=g[this.get("regionId")];
if(k){l.local={stateAbbreviation:k,program:c[this.get("loanTypeId")],loanToValueBucket:j[this.get("downPaymentId")],creditScoreBucket:i[this.get("creditId")]};
}a.ZMM.API.MAX({action:"getRates",input:{partnerId:a.ZMM.API.partnerId,queries:l,durationDays:h[this.get("timeframeId")],includeCurrentRate:true},context:this,success:this._handleRateResponse,failure:this._handleRateResponse});
},_shouldUseLocalVolume:function(l){var n=0,k=5,o,m;if(!l||!l.rates||!l.rates.local){return false;}for(m=0;
m<l.rates.local.length;m+=1){o=l.rates.local[m];if(!o||!o.volume){n++;if(n>=k){return false;}}}return true;
},_handleRateResponse:function(k){var l=this.get("_rateChart"),m=this._shouldUseLocalVolume(k);if(k&&k.rates&&k.rates.national&&k.rates.national.currentRate){this.set("nationalRate",k.rates.national.currentRate.rate);
this.set("nationalVolume",k.rates.national.currentRate.volume);}if(k&&k.rates&&k.rates.local&&k.rates.local.currentRate){this.set("localRate",k.rates.local.currentRate.rate);
this.set("localVolume",k.rates.local.currentRate.volume);}if(this.get("showQuoteVolume")){if(m){l.set("volumeType",a.ZMM.RateChart.SERIES_TYPE.LOCAL);
}else{l.set("volumeType",a.ZMM.RateChart.SERIES_TYPE.NATIONAL);}}else{l.set("volumeType",a.ZMM.RateChart.SERIES_TYPE.NONE);
}l.set("dataProvider",this._createDataProvider(k));},_createDataProvider:function(l){var m=[],u,o,s,t,v=0,k=[],r,p,n,q=0;
if(!l||!l.rates||!l.rates.national||!l.rates.national.samples||!l.rates.national.currentRate){return m;
}p=l.rates.local;o=l.rates.national.samples;if(p){k=l.rates.local.samples;}if(l.rates.national.currentRate.volume>0&&(!p||l.rates.local.currentRate.volume>0)){o.push(l.rates.national.currentRate);
if(p){k.push(l.rates.local.currentRate);}}while(v<o.length||q<k.length){u={};s=(v<o.length?o[v]:null);
t=(s!=null?a.ZMM.Datetime.iso8601ToLocalDate(s.time):null);r=(q<k.length?k[q]:null);n=(r!=null?a.ZMM.Datetime.iso8601ToLocalDate(r.time):null);
if(s!=null&&(r==null||t<=n)){u.date=t;u.nationalPercentageRate=s.rate;u.nationalQuoteVolume=s.volume;
v+=1;}if(r!=null&&(t==null||n<=t)){u.date=n;u.localPercentageRate=r.rate;u.localQuoteVolume=r.volume;
q+=1;}m.push(u);}return m;}},{ATTRS:{_rateChart:{value:null},showQuoteVolume:{value:true},regionSelector:{value:"#rid"},loanTypeSelector:{value:"#loty"},creditSelector:{value:"#ch"},downPaymentSelector:{value:"#lotv"},quoteVolumeSelector:{value:"#show-volume-checkbox"},timeframeSelector:{value:"#ts"},regionId:{value:null},loanTypeId:{value:null},creditId:{value:null},downPaymentId:{value:null},timeframeId:{value:null},nationalRate:{value:null},nationalVolume:{value:null},localRate:{value:null},localVolume:{value:null},news:{value:null},_chartRequest:{value:null}}});
},"3.7.3",{requires:["io-base","yui-log","base-base","json-parse","zmm-api","zmm-datetime","zmm-rate-chart","zmm-util"]});
